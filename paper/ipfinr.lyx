#LyX file created by tex2lyx 2.0.2
\lyxformat 413
\begin_document
\begin_header
\textclass article
\begin_preamble
% Todo: consolidate two sets of tables for intro eg


\usepackage{booktabs}\usepackage{fancyvrb}\usepackage{listings}\usepackage{bm}\usepackage{xcolor}\usepackage{multirow}\usepackage{booktabs}

\usepackage{array}\newcolumntype{C}[1]{>{\arraybackslash}p{#1}}

\usepackage[capitalise]{cleveref}

\xdefinecolor{gray}{rgb}{0.4,0.4,0.4}
\xdefinecolor{blue}{RGB}{58,95,205}% R's royalblue3; #3A5FCD

\lstset{% setup listings
        language=R,% set programming language
        basicstyle=\ttfamily,% basic font style
        keywordstyle=,% keyword style
        commentstyle=\color{gray},% comment style
        numberstyle=\scriptsize,% use small line numbers
        numbersep=10pt,% space between line numbers and code
        tabsize=3,% sizes of tabs
        showstringspaces=false,% do not replace spaces in strings by a certain character
        captionpos=b,% positioning of the caption below
        breaklines=true,% automatic line breaking
        escapeinside={(*}{*)},% escaping to LaTeX
        fancyvrb=false,% verbatim code is typset by listings
        extendedchars=false,% prohibit extended chars (chars of codes 128--255)
        literate={"}{{\texttt{"}}}1{<--}{{$\bm\leftarrow$}}1{<<-}{{$\bm\twoheadleftarrow$}}1
        {~}{{$\bm\sim$}}1{<=}{{$\bm\le$}}1{>=}{{$\bm\ge$}}1{!=}{{$\bm\neq$}}1{^}{{$^{\bm\wedge}$}}1,% item to replace, text, length of chars
        alsoletter={.<-},% becomes a letter
        alsoother={$},% becomes other
        otherkeywords={!=, ~, $, \&, \%/\%, \%*\%, \%\%, <-, <<-, /},% other keywords
        deletekeywords={c}% remove keywords
}


\graphicspath{{../figure/}}

%opening
\title{The performance of Iterative Proportional Fitting for spatial microsimulation: applying new tests to an old technique}
\author{Robin Lovelace}


\end_preamble
\use_default_options false
\language english
\language_package none
\inputencoding utf8x
\fontencoding default
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\paperfontsize 10
\spacing single
\use_hyperref 1
\pdf_bookmarks 1
\pdf_bookmarksnumbered 0
\pdf_bookmarksopen 0
\pdf_bookmarksopenlevel 1
\pdf_breaklinks 0
\pdf_pdfborder 0
\pdf_colorlinks 0
\pdf_backref section
\pdf_pdfusetitle 1
\papersize a4paper
\use_geometry false
\use_amsmath 1
\use_esint 1
\use_mhchem 0
\use_mathdots 0
\cite_engine natbib_authoryear
\use_bibtopic false
\paperorientation portrait
\suppress_date false
\use_refstyle 0
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Abstract

Iterative Proportional Fitting (IPF), also known as biproportional fitting or the RAS algorithm, is an established technique in Regional Science and has been used for a variety of purposes in the field. Primary amongst these has been the generation of small area microdata. The technique is mature, widely used and relatively straight-forward yet there have been few studies focused on evaluation of its performance. An additional research problem is the tendency of researchers to `start from scratch', resulting in a variety ad-hock implementations, with little evidence about the relative merits of differing approaches. Although IPF is well described mathematically, reproducible examples of the algorithm, written in modern programming languages, are rare in the academic literature. These knowledge gaps mean that answers to methodological questions must be guessed: Under what conditions can conversion be expected? How many iterations should be used for any given application? And what are the impacts of initial weights and integerisation on the final result? This paper tackles such questions, using a systematic methodology based on publicly available code and input data. The results confirm IPF's status as robust and widely applicable method for combining areal and individual-level data and demonstrate the importance of using various metrics of for determining its performance. We conclude with an agenda for future tests and offer more general guidance on how the method can be optimised to maximise its utility for future research.
\end_layout

\begin_layout Abstract

Keywords: Iterative proportional fitting, spatial microsimulation, modelling
\end_layout

\begin_layout Abstract

JEL Code: C 
\end_layout

\begin_layout Section

Notes for authors
\end_layout

\begin_layout Standard

Additonal papers to cite include: 
\end_layout

\begin_layout Itemize


\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "harland2012"

\end_inset

 
\end_layout

\begin_layout Itemize


\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Smith2009"

\end_inset

 
\end_layout

\begin_layout Itemize


\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Cullinan2010"

\end_inset

 
\end_layout

\begin_layout Itemize


\end_layout

\begin_layout Section

Introduction
\end_layout

\begin_layout Standard

The aggregation of survey data has a long history in the social sciences. Generally this involves translating raw data from a `long' format --- the usual format of raw census data as it is digitised and entered into a database, where each row represents an individual and each column a separate variable --- to a `wide' data format 
\begin_inset CommandInset citation
LatexCommand citep
after "Chapter 9"
before ""
key "van2012flexible"

\end_inset

. The wide data form, where each row represents a geographic area or other sub-group of the total population and each column represents a variable value or bin (see 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

fmsim-schema
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

), generally occupies less disk space for storage but has some important disadvantages. Data loss usually occurs when georeferenced individual level survey data --- 
\emph on
spatial microdata
\emph default
 --- is aggregated into the wide form, especially when continuous variables are converted into discrete categories and when not cross-tabulations, such as age/income, are not provided. The process of aggregation is performed in three steps: 
\end_layout

\begin_layout Enumerate

conversion of all variables into discrete categories (e.g.
\begin_inset space ~

\end_inset

an individual with an income of £13,000 per year would be allocated to band of £10,000 to £15,000 per year) 
\end_layout

\begin_layout Enumerate

assignment of a column to each unique category 
\begin_inset ERT
status collapsed

\begin_layout Standard

% --- and in some cases each category combination ---
\end_layout

\begin_layout Standard


\end_layout

\end_inset

 
\end_layout

\begin_layout Enumerate

assignment of integer counts to cells in each column to represent the number of people with each characteristic. 
\end_layout

\begin_layout Standard

Frequently, large national social survey datasets such as censuses are 
\emph on
only
\emph default
 available in the wide, geographically aggregated form. This is problematic for the analysis of spatial phenomena 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Openshaw1984,Lee2009"

\end_inset

. It is from this context of common forms of geographical data storage formats that this paper departs.
\end_layout

\begin_layout Standard

Iterative proportional fitting (IPF) can help overcome the limitations of wide, geographically aggregated data sources when used in 
\emph on
spatial microsimulation
\emph default
. In simplistic terms spatial microsimulation can be understood as the reversal of geographic aggregation described in points 1--3 above, to approximate the original `long' dataset (
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

fmsim-schema
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

). Thus the need for spatial microsimulation is driven by the tendency of statistical agencies to make the raw georeferenced microdata generated by large social surveys unavailable to the research community 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Lee2009"

\end_inset

. In fact spatial microsimulation, the term favoured by geographers and regional scientists, is generally known as 
\emph on
population synthesis
\emph default
 in transport modelling, which is and apt name: its core function is to simulate populations based on imperfect data. Spatial microsimulation can also refer to a wider approach which harnesses spatial microdata in the analysis stage 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Holm1987, Lovelace2014-jtg"

\end_inset

. In this paper we focus on the former meaning, which is also known as 
\emph on
static spatial microsimulation
\emph default
 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Ballas2005c"

\end_inset

.
\end_layout

\begin_layout Standard


\begin_inset Float figure
wide false
sideways false
status open


\begin_layout Standard
\align center


\begin_inset Graphics 
	filename msim-schema
	width 10cm

\end_inset

 
\end_layout

\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Schema of iterative proportional fitting (IPF) and combinatorial optimisation in the wider context of the availability of different data formats and spatial microsimulation. 
\begin_inset CommandInset label
LatexCommand label
name "fmsim-schema"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

What is IPF and why use it?
\end_layout

\begin_layout Standard

IPF is a statistical procedure that enables the calculation of 
\emph on
maximum likelihood
\emph default
 of cell values that are constrained by multiple marginal totals. Some confusion surrounds the procedure because it has multiple names: the `RAS algorithm', `biproportional fitting' and to a lesser extent `raking' have all been used to describe the procedure at different times and in different branches of academic research 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Lahr2004"

\end_inset

. `Entropy maximisation' is a related technique, of which IPF is considered to be a subset 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Johnston1993,Rich2012"

\end_inset

.
\begin_inset Foot
status collapsed


\begin_layout Standard

As an aside, IPF is considered by 
\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Rich2012"

\end_inset

 to be a particular efficient for of entropy maximisation: 
\begin_inset Quotes eld
\end_inset

The popularity of the IPF is therefore mainly due to the fact that it provides a solution which is equivalent to that of the ME approaches, but attained in a much more computationally efficient way
\begin_inset Quotes erd
\end_inset

 (p.
\begin_inset space ~

\end_inset

469). 
\end_layout

\end_inset

 Usage characteristics of these different terms are summarised in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

tterms
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Usage characteristics of different terms for the IPF procedure, from the Scopus database
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="8" columns="5">
<features tabularvalignment="middle">
<column alignment="left" valignment="top">
<column alignment="none" valignment="top" width="1.5cm">
<column alignment="none" valignment="top" width="2.5cm">
<column alignment="none" valignment="top" width="1.5cm">
<column alignment="none" valignment="top" width="2.5cm">
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 Search term 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

N. citations 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Commonest subject area 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

% Since 2010 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

% Mentioning 
\begin_inset Quotes eld
\end_inset

regional
\begin_inset Quotes erd
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 Entropy maximisation 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

564 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Engineering 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

30 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

9 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Quotes eld
\end_inset

Iterative proportional fitting
\begin_inset Quotes erd
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

135 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Mathematics 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

22
\begin_inset space \space{}

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

16 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Quotes eld
\end_inset

RAS Algorithm
\begin_inset Quotes erd
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

25 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Comp. science 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

24 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

24 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Quotes eld
\end_inset

Iterative proportional scaling
\begin_inset Quotes erd
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

15 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Mathematics 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

27 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

0 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Matrix raking 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

12 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Engineering 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

50 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

0 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Biproportional estimation 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

12 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Social sciences 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

17 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

33 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "tterms"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

Ambiguity in terminology surrounding the procedure has existed for a long time: when Michael Bacharach began using the term `biproportional' late 1960s, he did so with the following caveat: 
\begin_inset Quotes eld
\end_inset

The `biproportional' terminology is not introduced in what would certainly be a futile attempt to dislodge `RAS', but to help to abstract the mathematical characteristics from the economic associations of the model
\begin_inset Quotes erd
\end_inset

 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "bacharach1970biproportional"

\end_inset

. The original formulation of the procedure is generally ascribed to 
\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Deming1940"

\end_inset

, who presented an iterative procedure for solving the problem of how to modify internal cell counts of census data in `wide' form, based on new marginal totals. Without repeating the rather involved mathematics of this discovery, it is worth quoting again from 
\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "bacharach1970biproportional"

\end_inset

, who provided as clear a description as any of the procedure in plain English: 
\begin_inset Quotes eld
\end_inset

The method that Deming and Stephan suggested for computing a solution was to fit rows to the known row sums and columns to the known column sums by alternate [iterative] scalar multiplications of rows and columns of the base matrix
\begin_inset Quotes erd
\end_inset

 (p.
\begin_inset space ~

\end_inset

4). The main purpose for revisiting and further developing the technique from Bacharach's perspective was to provide forecasts of the sectoral disaggregation of economic growth models for the British government. It was not until later (e.g.
\begin_inset space ~

\end_inset


\begin_inset CommandInset citation
LatexCommand citealp
after ""
before ""
key "Holm1987"

\end_inset

) that the procedure was rediscovered for geographic research.
\end_layout

\begin_layout Standard

Thus IPF is a general purpose tool with multiple uses. In this paper we focus on its ability to 
\emph on
disaggregate
\emph default
 the geographically aggregated data typically provided by national statistical agencies to synthesis 
\emph on
spatial microdata
\emph default
, as illustrated in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

fmsim-schema
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

. But why would one want do this in the first place?
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% Each row in this aggregated form can 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% represent the entire dataset or subsets thereof. (Geographical aggregation – one row 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% per zone – is the most common form of aggregation, but any subsets, from social class, 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% time period or other 
\backslash
emph{cross-tablulations} of the dataset can be used).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard

To answer this question, let us briefly consider the advantages and drawbacks of the ubiquitous wide data format. The main advantages of wide datasets are that they can summarise information about very many individuals in a relatively few rows, saving storage space, easing the analysis and, critically for policy makers, ensuring the anonymity survey respondents. But the process of aggregation used to create wide data is almost always associated with data loss, leading to the following disadvantages: 
\end_layout

\begin_layout Itemize


\emph on
Binning of continuous variables:
\emph default
 we do not know from a wide dataset if the aforementioned person earning £13,000 is in fact on a salary of £10,000, £15,000 or anywhere in between 
\end_layout

\begin_layout Itemize


\emph on
Loss of geographical resolution:
\emph default
 when aggregation is done by geographical zones 
\begin_inset ERT
status collapsed

\begin_layout Standard

%  --- as is usually the case ---
\end_layout

\begin_layout Standard


\end_layout

\end_inset

 spatial information is lost. Instead of knowing person's precise home location, from the full dataset, we may only be able to pin them down to a relatively large administrative area. 
\end_layout

\begin_layout Itemize


\emph on
Loss of cross-tabulation
\emph default
: during the process of aggregation the links between different variables, often expressed as `contingency tables', is usually lost. For example a female cyclist will be represented as additional units in the 
\begin_inset Quotes eld
\end_inset

cyclist
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

female
\begin_inset Quotes erd
\end_inset

 categories, without knowledge of their interrelation. 
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% make bullet points???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard

In the 
\emph on
physical sciences
\emph default
 both data formats are common and the original long dataset is generally available. In the social sciences, by contrast, the long format is often unavailable due to the long history of and confidentiality issues surrounding officially collected survey data. It is worth emphasising that National Census datasets --- in which characteristics of every individual living in a state are recorded and which constitute some of the best datasets in social science --- are usually only available in wide form. This poses major challenges to researchers in the sciences who interested in intra-zone variability at the local level 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Whitworth2012,Lee2009"

\end_inset

.
\end_layout

\begin_layout Standard

A related long-standing research problem especially prevalent in geography and regional science is the scale of analysis. There is often a trade-off between the quality and resolution of the data, which can result in a compromise between detail and accuracy of results 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "ballas2003microsimulation-30-years"

\end_inset

. A common scenario facing researchers investigating a spatial problem is being presented with two datasets: one long aspatial survey table where each row represents the characteristics of an individual --- such as age, sex, employment status and income --- and another of wide, geographically aggregated dataset containing count data for each category. IPF solves this problem when used in spatial microsimulation by proportionally assigning individuals to zones of which they are most representative. 
\begin_inset ERT
status collapsed

\begin_layout Standard

% It is these `linking variables'
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% that enable IPF to converge on the weights that best represent how representative each individual is
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% of each zone, as described in the next section.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% could take this out...
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% As illustrated in 
\backslash
cref{fmsim-schema}, wide datasets are
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% are wider and shorter, containing multiple columns for each variable from the raw dataset,
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% causing loss of information about the linkages between different variables, their 
\backslash
emph{cross tabulations}.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% The solution to this problem, however, makes the wide datasets even more unwieldy, as
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% each new cross-tabulated variable adds $nv 
\backslash
times ncol(X)$  
\backslash
emph{more} columns to the 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% wide dataset, where $nv$ is the number discrete categories in the new variable and $ncol(x)$
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% is the existing number of columns in the wide data 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% table.
\backslash
footnote{To 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% provide a concrete example, a cross-tabulation 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% of mode of travel to work by sex and social class would contain 540 (12 * 3 * 15) columns,
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% due to the number of categories present in each variable. 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% Given that there are dozen of additional variables in any large census, this clearly becomes
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% rapidly unwieldy as more variables are added.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% } % figure???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% The lack of cross tabulation is problematic because 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% in many cases information about the linkages between different variables is needed to 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% address policy-relevant questions. To pick one example related to 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% policies targeted at skilled unemployed young adults: how many unemployed people 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% reside in each geographical area who at the same time have a university degree, 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% are female and over 25 years old? This question is impossible to answer with a 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% geographically aggregated (wide) dataset.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

IPF in spatial microsimulation
\end_layout

\begin_layout Standard

Spatial microsimulation tackles the aforementioned problems associated with the prevalent geographically aggregated wide data form by simulating the individuals within each administrative zone. The most detailed output of this process of spatial microsimulation is `spatial microdata', a long table of individuals with associated attributes and weights for each zone (see 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:w
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard

%???really
\end_layout

\begin_layout Standard


\end_layout

\end_inset

 for a simple example). Because these individuals correspond to observations in the survey dataset, the spatial microdata generated in this way, of any size and complexity, can be stored with only 3 columns: person identification number (ID), zone and weight. Weights are critical to spatial microdata generated in this way, as they determine how representative each individual is of each zone. Thus, an even more compact way of storing spatial microdata taken from a single dataset is as a `weight matrix' (table 2). 
\begin_inset ERT
status collapsed

\begin_layout Standard

% the same dataset can be stored using only two variables:  
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% small area microdata 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% by combining the small area data with national survey data. The result of this process 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% of population synthesis (in its long % have we already defined long?
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

%  form --- it can also be represented in a wide table of counts)
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

%  is a table in which rows represent each 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% individual in the study region, with an additional column indicating the area of residence (Table 1).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard

Representing the data in this form offers a number of advantages (Clarke and Holm, 1987). These include: 
\end_layout

\begin_layout Itemize

The ability to investigate intra-zone variation (variation within each zone can be analysed by subsetting a single area from the data frame). 
\end_layout

\begin_layout Itemize

Cross-tabulations can be created for any combination of variables (e.g. age and employment status). 
\end_layout

\begin_layout Itemize

The presentation of continuous variables such as income as real numbers, rather than as categorical count data, in which there is always data loss. 
\end_layout

\begin_layout Itemize

The data is in a form that is ready to be passed into an individual-level model. For example individual behaviour could simulate traffic, migration or the geographical distribution of future demand for healthcare. 
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% A potential downside of spatial microdata is that it can provide a misleading impression about the 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% quality and detail of the input data. It is important to remember that spatial microdata generated 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% in this way through spatial microsimulation are only as good as the constraint variables and the 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% extent to which the national dataset is representative of the zones in the study area.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard

These benefits have not gone unnoticed by the spatial modelling community. Spatial microsimulation is now more than a methodology, and can be considered as a research field in its own right, with a growing body of literature, methods and results 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Tanton2013"

\end_inset

. In tandem with these methodological developments, a growing number of applied studies has emerged to take advantage of the new possibilities opened up by such small area individual-level data, with applications as diverse as the location of health services 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Tomintz2008"

\end_inset

 to the analysis of commuting 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Lovelace2014-jtg"

\end_inset

. Various strategies for generating small area microdata are available, as described in recent overviews on the subject 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Tanton2013, Ballas2013-4policy-analysis, Hermes2012a"

\end_inset

. However, it is not always clear which one is most appropriate. There has been work testing 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Jirousek1995"

\end_inset

 and improving 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "teh2003improving"

\end_inset

 in abstract terms, but research focused on testing use the algorithm for spatial microsimulation. This research gap is highlighted in the conclusions of a recent Reference Guide to spatial microsimulation 
\begin_inset CommandInset citation
LatexCommand citep
after "p~270"
before ""
key "Clarke2013-concs"

\end_inset

: 
\begin_inset Quotes eld
\end_inset

It would be desirable if the spatial microsimulation community were able to continue to analyse which of the various reweighting/synthetic reconstruction techniques is most accurate --- or to identify whether one approach is superior for some applications while another approach is to be preferred for other applications
\begin_inset Quotes erd
\end_inset

. This paper rises to this challenge by systematically testing the IPF algorithm for spatial microsimulation. Before proceeding to the model experiments, we first provide a brief overview of the applications of IPF in regional science and outline the theory underlying the procedure based on a simple example. 
\begin_inset ERT
status collapsed

\begin_layout Standard

% The longest-established and most straight-forward of
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% these is Iterative Proportional Fitting (IPF), the performance of which is the subject of this paper...
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

Applications
\end_layout

\begin_layout Standard


\series bold
Dimitris and Eveline: please fill in this section
\series default
 Applications of IPF include using it ...
\end_layout

\begin_layout Standard

The application of greatest interest to regional scientists is as a method of spatial microsimulation: generating individual level data allocated to specific zones... Papers that have used IPF in this context (or a substitutable method such as simulated annealing) have explored a range of regional economic problems that purely aggregate level analyses struggle to address. These include: 
\end_layout

\begin_layout Itemize

using spatial microdata to analyses the wider impacts of major job losses at the local level 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Ballas2006"

\end_inset

. 
\end_layout

\begin_layout Itemize

an investigation into to local impacts of the marine sector in Ireland 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Morrissey2013a"

\end_inset

 
\end_layout

\begin_layout Itemize

... 
\end_layout

\begin_layout Itemize

... 
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
section{IPF: theory and a worked example}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% Iterative Proportional Fitting has a long history in Statistics and the social
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% sciences (especially in Economics and Geography).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% In statistical language, IPF is used to estimate the values of internal
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% cells in a cross-tabulated table to fit known margins.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% The method is also known as matrix raking or scaling,
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% biproportional fitting, RAS, and entropy maximising.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% There are a number of texts discussing the method in a mathematical formal
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% way in some detail (for example 
\backslash
citealp{Mosteller1968, Fienberg1970, Pritchard2012}).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
citep{Birkin1988} provide a succinct presentation of the
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% mathematics of IPF and their work is the foundation of
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% the work presented here...% described in origin; rethink this...???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Section

The IPF algorithm: a worked example
\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "s:theory"

\end_inset

 In many modelling texts there is a precedence of theory over application: the latter usually flows from the former. As outlined in the previous section, the mathematics underlying IPF have been thoroughly demonstrated in research stemming back to the 1940s, yet 
\emph on
practical
\emph default
 demonstrations, focused on making the algorithm as accessible as possible to others, are comparatively rare. For this reason this section presents a simple worked example. The steps are, to the authors knowledge, presented in more detail than any previous work, to address the theory:practice balance and ensure accessibility to understanding of the method.
\end_layout

\begin_layout Standard

That is not to say that reproducibility is completely absent in the field. 
\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Simpson2005"

\end_inset

 and 
\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Norman1999a"

\end_inset

 exemplify their work with code snippets from an implementation of IPF in the proprietary software SPSS and reference to an Excel macro that is available on request, respectively. 
\begin_inset CommandInset citation
LatexCommand citet
after ""
before ""
key "Williamson2007"

\end_inset

 also represents good practice in this regard, with a manual for running combinatorial optimisation algorithms described in previous work and 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Ballas2005c"

\end_inset

 demonstrate IPF with a worked example to be calculated using mental arithmetic, but does not progress to illustrate how the examples are then implemented in computer code. This section builds on and extends this work, by first outlining an example that can be completed using mental arithmetic alone before illustrating its implementation in code. 
\begin_inset ERT
status collapsed

\begin_layout Standard

%Have you implemented in R???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% Importantly for for reproducible research this theory section
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% is illustrated with a simple worked example that culminates in
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% a question to the reader, to test his or her understanding.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% It is worth restating that IPF is a simple statistical procedure, % why???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% ``in which cell counts in a contingency
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% table containing the sample observations are scaled to be consistent with
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% various externally given population marginals'' 
\backslash
citep{mcfadden2006testing}. In
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% other words, and in the context of 
\backslash
emph{spatial} microsimulation, IPF produces
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% maximum likelihood estimates for the frequency with which people appear in
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% different areas.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% The method is also known as `matrix raking' or the RAS %%% may want to re-include at some point
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% algorithm, 
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% % (
\backslash
citealp{Birkin1988, Muller2010,Simpson2005, Kalantari2008, Jirousek1995})
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

%  and has been described as one
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% particular instance of a more general procedure of `entropy maximisation'
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
citep{Johnston1993, blien1998entropy}.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% The mathematical properties of IPF
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% have been described in several papers
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% (
\backslash
citealp{Bishop1975, Fienberg1970, Birkin1988}).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% Illustrative examples of the procedure can be found in
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
citet{Saito1992}, 
\backslash
citet{Wong1992}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% and 
\backslash
citet{Norman1999a}. 
\backslash
citet{Wong1992} investigated the reliability of IPF
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% and evaluated the importance of different factors influencing the its
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% performance. Similar methodologies have since been employed by
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
citet{Mitchell2000}, 
\backslash
citet{Williamson2002} and
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% Ballas et al.~
\backslash
citeyearpar{Ballas2005c}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% to investigate a wide range of phenomena.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% The example described below is a modified version
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
citet{Ballas2005c}.
\backslash
footnote{In 
\backslash
citet{Ballas2005c}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% the interaction between the age and sex constraints are assumed to be known.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% (Their equivalent of 
\backslash
cref{t:s2} contains data for every cell,
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% not question marks.) This results in IPF converging instantly.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% However, in Census data, such cross-tabulation is
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% often absent, and IPF must converge over multiple constraints and
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% iterations. This latter scenario is assumed in the worked example below. Other
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% worked examples of the principles are provided in 
\backslash
citet[Appendix
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 3]{johnston1985geography} (for entropy maximisation), 
\backslash
citet{Norman1999a} and
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
citet{Simpson2005} (using the proprietary statistical software SPSS).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% }
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard

Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:w"

\end_inset

 describes a hypothetical microdataset comprising 5 individuals, who are defined by two constraint variables, age and sex. Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:s"

\end_inset

 contains aggregated data for a hypothetical area, as it would be downloaded from census dissemination portal Casweb. 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
Cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:s2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 illustrates this table in a different form, demonstrating the unknown links between age and sex.
\end_layout

\begin_layout Standard


\begin_inset Float table
placement h
wide false
sideways false
status open


\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
centering
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Standard


\begin_inset Argument
status collapsed

\begin_layout Standard

A hypothetical input microdata set
\end_layout

\end_inset

A hypothetical input microdata set (the original weights set to one). The bold value is used subsequently for illustrative purposes.
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="7" columns="4">
<features tabularvalignment="middle">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Individual 
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Sex
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Age-group
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Weight
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

59 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

54 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Male
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

35
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\series bold
1
\series default
 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

73 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

49 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% 1 & 59 & m 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 2 & 54 & m 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 3 & 35 & m 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 4 & 73 & f 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 5 & 49 & f 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "t:w"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset VSpace 1cm
\end_inset


\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
centering
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Standard

Hypothetical small area constraints data (
\begin_inset Formula $s$
\end_inset

).
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="5" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 Constraint 
\begin_inset Formula $\Rightarrow$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $i$
\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $j$
\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Category 
\begin_inset Formula $\Rightarrow$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $i_1$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $i_2$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $j_1$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $j_2$
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Area 
\begin_inset Formula $\Downarrow$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Under-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

8 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "t:s"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset VSpace 1cm
\end_inset


\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
centering
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Standard


\begin_inset Argument
status collapsed

\begin_layout Standard

Small area constraints expressed as marginal totals
\end_layout

\end_inset

Small area constraints expressed as marginal totals, and the cell values to be estimated.
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="6" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 Marginal totals
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $j$
\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Age/sex 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

T
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
multirow
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

*
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset


\begin_inset Formula $i$
\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Under-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\series bold
?
\series default
 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

? 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

8
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

? 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

? 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

T 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

12
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "t:s2"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:m"

\end_inset

 presents the hypothetical microdata in aggregated form, that can be compared directly to Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:s2"

\end_inset

. Note that the integer variable age has been converted into a categorical variable in this step, a key stage in geographical aggregation.
\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
centering
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Standard


\begin_inset Argument
status collapsed

\begin_layout Standard

The aggregated results of the weighted microdata set
\end_layout

\end_inset

The aggregated results of the weighted microdata set (
\begin_inset Formula $m(1)$
\end_inset

). Note, these values depend on the weights allocated in Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:w"

\end_inset

 and therefore change after each iteration
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="6" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 Marginal totals
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $j$
\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Age/sex 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

T
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
multirow
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

*
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset


\begin_inset Formula $i$
\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Under-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\series bold
1
\series default
 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

T 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "t:m"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

Using these data it is possible to readjust the weights of the hypothetical individuals, so that their sum would add up to the totals given in Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:s2"

\end_inset

 (12). In particular, the weights can be readjusted by multiplying them by the marginal totals, originally taken from Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:s"

\end_inset

 and then divided by the respective marginal total in 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:m"

\end_inset

. Because the total for each small-area constraint is 12, this must be done one constraint at a time. This can be expressed, for a given area and a given constraint (
\begin_inset Formula $i$
\end_inset

 or age in this case), as follows:
\end_layout

\begin_layout Standard


\begin_inset Formula \begin{equation}
w(n+1)_{ij} = \frac{w(n)_{ij} \times sT_{i}}{mT(n)_{i}}
\label{eq:ipf}
\end{equation}
\end_inset

 where 
\begin_inset Formula $w(n+1)_{ij}$
\end_inset

 is the new weight for individuals with characteristics 
\begin_inset Formula $i$
\end_inset

 (age, in this case), and 
\begin_inset Formula $j$
\end_inset

 (sex), 
\begin_inset Formula $w(n)_{ij}$
\end_inset

 is the original weight for individuals with these characteristics, 
\begin_inset Formula $sT_{i}$
\end_inset

 is element marginal total of the small area constraint, 
\begin_inset Formula $s$
\end_inset

 (Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:s"

\end_inset

) and 
\begin_inset Formula $mT(n)_{i}$
\end_inset

 is the marginal total of category 
\begin_inset Formula $j$
\end_inset

 of the aggregated results of the weighted microdata, 
\begin_inset Formula $m$
\end_inset

 (Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:m"

\end_inset

). 
\begin_inset Formula $n$
\end_inset

 represents the iteration number. Although the marginal totals of 
\begin_inset Formula $s$
\end_inset

 are known, its cell values are unknown. Thus, IPF estimates the interaction (or cross-tabulation) between constraint variables. (Follow the emboldened values in the tables to see how the new weight of individual 3 is calculated for the sex constraint.) Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:new-weights"

\end_inset

 illustrates the weights that result. Notice that the sum of the weights is equal to the total population, from the constraint variables.
\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
centering
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Standard

Reweighting the hypothetical microdataset in order to fit Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "t:s"

\end_inset

.
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="7" columns="5">
<features tabularvalignment="middle">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Individual
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Sex
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

age-group
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

Weight
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

New weight, w(2)
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $1 \times 4/3 = \frac{4}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $1 \times 4/3 = \frac{4}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Under-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $\textbf{1} \times
\textbf{8}/\textbf{2} = 4$
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $1 \times 4/3 = \frac{4}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Under-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

1 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $1 \times 8/2 = 4$
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "t:new-weights"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

After the individual level data have been re-aggregated (
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:m2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

), the next stage is to repeat 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

eq:ipf
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 for the age constraint to generate a third set of weights, by replacing the 
\begin_inset Formula $i$
\end_inset

 in 
\begin_inset Formula $sT_{i}$
\end_inset

 and 
\begin_inset Formula $mT(n)_{i}$
\end_inset

 with 
\begin_inset Formula $j$
\end_inset

 and incrementing the value of n:
\end_layout

\begin_layout Standard


\begin_inset Formula \begin{equation}
w(3)_{ij} = \frac{w(2)_{ij} \times sT_{j}}{mT(2)_{j}}
\label{eq:ipf2}
\end{equation}
\end_inset


\end_layout

\begin_layout Standard

To test your understanding of IPF, apply 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

eq:ipf2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 to the information above and that presented in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:m2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

. This should result in the following vector of new weights, for individuals 1 to 5: 
\begin_inset Formula \begin{equation}
  w(3) = (\frac{6}{5}, \frac{6}{5}, \frac{18}{5}, \frac{3}{2}, \frac{9}{2})
\end{equation}
\end_inset

 As before, the sum of the weights is equal to the population of the area (12). Notice also that after each iteration the fit between the marginal totals of 
\begin_inset Formula $m$
\end_inset

 and 
\begin_inset Formula $s$
\end_inset

 improves. The total absolute error (TAE) from 
\begin_inset Formula $m(1)$
\end_inset

 to 
\begin_inset Formula $m(2)$
\end_inset

 improves from 14 to 6 in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:m
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 and 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:m2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 above. TAE for 
\begin_inset Formula $m(3)$
\end_inset

 (not shown, but calculated by aggregating 
\begin_inset Formula $w(3)$
\end_inset

) improves even more, to 1.3. This number would eventually converge to 0 through subsequent iterations, as there are no empty cells in the input microdataset; a defining feature of IPF.
\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
centering
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Standard


\begin_inset Argument
status collapsed

\begin_layout Standard

Aggregated results after constraining for age
\end_layout

\end_inset

The aggregated results of the weighted microdata set after constraining for age (
\begin_inset Formula $m(2)$
\end_inset

). 
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Tabular 
<lyxtabular version="3" rows="6" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 Marginal totals
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $i$
\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Age/sex 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Male 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Female 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

T
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
multirow
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

*
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset


\begin_inset Formula $j$
\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Under-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

8
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

Over-50 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $\frac{8}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $\frac{4}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

T 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset Formula $6\frac{2}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5
\begin_inset Formula $\frac{1}{3}$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

12
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "t:m2"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

The above process, when applied to more categories (e.g. socio-economic class) and repeated iteratively until a satisfactory convergence occurs, results in a series of weighted microdatasets, one for each of the small areas being simulated. This allows for the estimation of variables whose values are not known at the local level (e.g. income) 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Ballas2005c"

\end_inset

. An issue with the results of IPF (absent from combinatorial optimisation methods), however, is that it results in non-integer weights: fractions of individuals appear in simulated areas. As described in the introduction, this is not ideal for certain applications. Integer weights allow the results of spatial microsimulation to be further processed using dynamic microsimulation and agent based modelling techniques 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Pritchard2012"

\end_inset

.
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% A key benefit from a policy perspective is that
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% IPF and other spatial microsimultion techniques
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% can provide estimation of variables whose values are not
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% known at the local level (e.g. income).
\end_layout

\begin_layout Standard


\end_layout

\end_inset

Spatial microsimulation can also provide insight into the likely distribution of individual level variables about which only geographically aggregated statistics have been made available. An issue with the results of IPF (absent from combinatorial optimisation methods), however, is that it results in non-integer weights: fractions of individuals appear in simulated areas.
\end_layout

\begin_layout Subsection

Implementing IPF in R
\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "simplementing"

\end_inset

 The above example is best undertaken by hand, probably with a pen and paper to gain an understanding of IPF, before the process is automated for larger datasets. This section explains how the IPF algorithm described above is implemented in R, using a slightly more complex example 
\begin_inset ERT
status collapsed

\begin_layout Standard

% This section is based on ``Spatial microsimulation in R: a
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% beginner’s guide to iterative proportional fitting (IPF)'', a tutorial
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% written to accompany a methods paper on integerisation
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Lovelace2013-trs"

\end_inset

.
\begin_inset Foot
status collapsed


\begin_layout Standard

This tutorial is available from Rpubs, a site dedicated to publishing R analyses that are reproducible. It uses the RMarkdown mark-up language, which enables R code to be run and presented within documents. See http://rpubs.com/RobinLovelace/5089 
\begin_inset CommandInset label
LatexCommand label
name "fnrpub"

\end_inset

 . 
\end_layout

\end_inset


\end_layout

\begin_layout Section

Evaluation techniques
\end_layout

\begin_layout Standard

To verify the integrity of any model, it is necessary to compare its outputs with empirical observations or prior expectations gleaned from theory. The same principles apply to spatial microsimulation, which can be evaluated using both internal and 
\emph on
external
\emph default
 validation methods 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Edwards2009"

\end_inset

. 
\emph on
Internal validation
\emph default
 is the process whereby the aggregate-level outputs of spatial microsimulation are compared with the input constraint variables. Internal validation typically tackle such issues as 
\begin_inset Quotes eld
\end_inset

do the simulated populations in each area microdata match the total populations implied by the constrain variables?
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

what is the level of correspondence between the cell values of different attributes in the aggregate input data and the aggregated results of spatial microsimulation?
\begin_inset Quotes erd
\end_inset

 As we shall see below, ideally we would hope for a perfect fit between the input and output datasets during internal evaluation. 
\emph on
External validation
\emph default
 is the process whereby the variables that are being estimated are compared to data from another source, external to the estimation process, so the output dataset is compared with another known dataset for those variables. 
\begin_inset ERT
status collapsed

\begin_layout Standard

%... ?
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard

This section outlines the evaluation techniques that are commonly used in the field, with a strong focus on internal validation. The options for external validation are heavily context dependent so must generally be decided on a case-by-case basis, and are mentioned in passing with a focus on general principles rather than specific advice. The methods are presented in ascending order of complexity and roughly descending order of frequency of use, ranging from Pearson's coefficient of correlation to entropy based measures. Before these methods are described, it is worth stating the purpose of this section is not to find the `best' evaluation metric: each has advantages and disadvantages, the importance of which will vary depending on the nature of the research. A final point is that the use of a variety of techniques in this paper is of interest in itself. The high degree of correspondence between them (presented in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

cresults
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

), suggests that researchers need only to present one or two metrics (but should perhaps try more, for corroboration) to establish relative levels of goodness of fit between different model configurations.
\end_layout

\begin_layout Subsection

Scatter plots and Pearson's coefficient of correlation
\end_layout

\begin_layout Standard

A scatter plot of cell counts for each category for the original and simulated variables is a basic but very useful preliminary diagnostic tool in spatial microsimulation 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Ballas2005c,Edwards2009"

\end_inset

. In addition marking the points, depending on the variable and category 
\begin_inset ERT
status collapsed

\begin_layout Standard

% have these been defined?
\end_layout

\begin_layout Standard


\end_layout

\end_inset

which they represent, can help identify which variables are particularly problematic, aiding the process of improving faulty code (sometimes referred to as `debugging').
\end_layout

\begin_layout Standard

In these scatter plots each data point represents a single zone-category combination (e.g. 16-25 year old female in zone 001), with the x axis value corresponding to the number of individuals of that description in the input constraint table. The y value corresponds to the aggregated count of individuals in the same category in the aggregated (wide) representation of the spatial microdata output from the model. 
\begin_inset ERT
status collapsed

\begin_layout Standard

% have we defined spatial microdata?
\end_layout

\begin_layout Standard


\end_layout

\end_inset

This stage can be conducted either before or after 
\emph on
integerisation
\emph default
 (more on this below). As taught in basic statistics courses, the closer the points to the 1:1 (45 degree, assuming the axes have the same scale) line, the better the fit.
\end_layout

\begin_layout Standard

Pearson's coefficient of correlation (henceforth Pearson's 
\begin_inset Formula $r$
\end_inset

) is a quantitative indicator of how much deviation there is from this ideal 1:1 line. It varies from 0 to 1, and in this context reveals how closely the simulated values fit the actual (census) data. An 
\begin_inset Formula $r$
\end_inset

 value of 1 represents a perfect fit; an 
\begin_inset Formula $r$
\end_inset

 value close to zero suggests no correspondence between then constraints and simulated outputs (i.e. that the model has failed). We would expect to see very high coefficient of determination for internal validation (the constraint) and strong positive correlation between target variables that have been estimated and external datasets (e.g. income). 
\begin_inset ERT
status collapsed

\begin_layout Standard

% However, regression analysis does not give any information about the fit of the simulated data to the ‘ideal’ line (i.e. where y  =  x and the simulated data is the same as the actual data). Rather, R 2 expresses the fit of the data to the ‘best fit’ line through that data. That is, the coefficient of determination is providing information about precision, not accuracy (Edwards and Tanton, 2013).
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% One way to do this is with a t test. With a spatial microsimulation model validation, the data are paired (given we are comparing simulated with actual data), thus an equal variance 2-tailed t test can be used to determine if there is any significant difference between the two datasets (i.e. simulated and actual). Thus, if the simulation is robust, we would expect to see no significant differences between the simulated and actual values for the input variables (and estimated/output variables, if known data are available). This enables the model accuracy to be assessed, as opposed to simply its precision.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

Standard error around identity (SEI)
\end_layout

\begin_layout Standard

here SEI is the standard error around identity, y are the estimated values for each area, y rel are the reliable estimates for each area from a census or other data source and y rel is the mean estimate for all areas where reliable data are available. This estimate has been used in validation by both Ballas and Tanton (see Ballas et al. 2007; Tanton et al. 2011).
\end_layout

\begin_layout Subsection

Total Absolute and Standardized Error (TAE and SAE)
\end_layout

\begin_layout Standard

The SAE addresses this issue by using the population size as the denominator, but generally, authors seem to use total population, rather than the population for that categorization of the variable, which may be deemed to understate the size of the errors. Also, this measure does not provide any information on whether any differences are statistically significant (Edwards and Tanton, 2013).
\end_layout

\begin_layout Subsection

Z scores
\end_layout

\begin_layout Standard

Here, the evaluation mainly takes place at the cell level (for a single constraint in a single area). However, there should also be attention for the overall picture like spatial concentration.
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% Spatial indicators etc??? Add equations to above methods soooon
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Section

Input data
\end_layout

\begin_layout Standard

Three input datasets form the basis of the scenarios tested in this paper, `simple', `small-area' and `sheffield'. Each consists of a set of aggregate constraints and corresponding individual-level survey tables. The latter are anonymous and have been `scrambled' to enable their publication online. This enables the results to be replicated by others, without breaching the user licenses of the data. To this end, all the input data (and code) used to generate the results reported in the paper are available online on the code-sharing site GitHub. The simplest scenario consists of 6 zones which must be populated by the data presented in the previous section (see 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:w
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

). 
\begin_inset ERT
status collapsed

\begin_layout Standard

% sample survey dataset of only five individuals, constrained by two variables (age and sex).
\end_layout

\begin_layout Standard


\end_layout

\end_inset

This scenario is purely hypothetical and is used to represent the IPF procedure and the tests in the simplest possible terms. Its small size allows the entirety of the input data to be viewed in a couple of tables (see 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:w
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 and 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t2
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

, the first row of which is used to exemplify the method the previous section). As with all data used in this paper, these tables can be viewed and downloaded online.
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
begin{table}[htbp]
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
caption{Individual-level data for the simple scenario. The file, `vailable from
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% the GitHub in the folder
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% `
\backslash
href{
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% https://github.com/Robinlovelace/IPF-performance-testing/tree/master/input-data/
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% small-area-eg}{input-data}'} % where???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
begin{center}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
begin{tabular}{rrl}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
toprule
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
multicolumn{1}{l}{Id} & 
\backslash
multicolumn{1}{l}{Age} & Sex 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
midrule
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 1 & 59 & m 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 2 & 54 & m 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 3 & 35 & m 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 4 & 73 & f 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 5 & 49 & f 
\backslash

\backslash

\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
bottomrule
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
end{tabular}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
end{center}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
label{t1}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
end{table}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Geographically aggregated constraint variables for the simple scenario.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center


\begin_inset Tabular 
<lyxtabular version="3" rows="9" columns="5">
<features tabularvalignment="middle">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
multicolumn{1}{l}{}
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard

Age constraint
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard

Sex constraint
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
<row>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="l">
\begin_inset Text

\begin_layout Standard

Zone
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard

16--49
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard

50+
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard

m
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="none" valignment="top" usebox="none" special="c">
\begin_inset Text

\begin_layout Standard

f
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
midrule
\end_layout

\end_inset

 1 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

8 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

8 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

7 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

8 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

7 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

7 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

4 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

5 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

3 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

2 
\end_layout

\end_inset
</cell>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard

6 
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "t2"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

The next smallest input dataset, and the most commonly used scenario in the paper, is `small-area'. The area constraints consist of 24 Output Areas (the smallest administrative unit in the UK), with an average adult population of 184. Three files describe the number of hours worked, the marital status and the tenancy of these individuals (although tenancy in fact counts houses, not people): the files can be accessed from `small-area-eg', within the `input-data' folder of the online repository.
\begin_inset Foot
status collapsed


\begin_layout Standard

These datasets can be found here: https://github.com/Robinlovelace/IPF-performance-testing/tree/master/input-data/ small-area-eg
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard

% Add these
\end_layout

\begin_layout Standard


\end_layout

\end_inset

A sample of these constraint variables is presented in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t3
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 below. 
\begin_inset ERT
status collapsed

\begin_layout Standard

% aren't we putting ind. data 1st?
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Sample of constraint variables from the first 5 rows of the small-area-eg input dataset.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center


\begin_inset Tabular 
<lyxtabular version="3" rows="1" columns="5">
<features tabularvalignment="middle">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "t3"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

The individual-level table that compliments these geographically aggregated count constraints is taken from Understanding Society wave 1. These have been randomised to ensure anonymity but they are still roughly representative of real data. The table consists of 1768 rows of data and is stored in R’s own space-efficient filetype (see 
\begin_inset Quotes eld
\end_inset

ind.RData
\begin_inset Quotes erd
\end_inset

, which must be opened in R). This individual level data consists of the same 3 constraint variables as provided in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t3
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 in addition to one `target variable': monthly pre-tax income in pounds stirling.
\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
begin{table}[htbp]
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
caption{Randomly selected sample of 5 individuals taken from the individual-level dataset.}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
begin{center}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
begin{tabular}{rrrrr}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
toprule
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
bottomrule
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
end{tabular}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
end{center}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
label{t4}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% 
\backslash
end{table}
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard

% ... More here on loading-up this data.
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Section

Method: model experiments
\end_layout

\begin_layout Subsection

Baseline scenarios
\end_layout

\begin_layout Standard

In order to perform a wide range of model experiments, in which only one factor is altered at a time, it was necessary to clearly define baseline scenarios. These are model runs with sensible defaults, which can be referred back to as a reference point and re-used at any point in the future. The baseline ‘simple’ scenario consists of 3 iterations, leading to a total of 6 constraint-iteration permutations. The results of simplest baseline scenario are shown in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

tblresults1
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

. The results show that the model fit improves after every iteration and every constraint in every measure of model fit (except `p5', which reaches zero in the second iteration) --- 
\begin_inset Formula $pcor$
\end_inset

 continues to improve, even though the printed value, to 6 decimal places, is indistinguishable from 1 after two complete iterations.
\end_layout

\begin_layout Standard


\begin_inset Float table
placement htbp
wide false
sideways false
status open


\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Results for the baseline `simple' scenario. Generated through by the ‘analysis’ script, and available as a .csv file online.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center


\begin_inset Tabular 
<lyxtabular version="3" rows="1" columns="5">
<features tabularvalignment="middle">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<column alignment="right" valignment="top">
<row>
<cell alignment="right" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
toprule
\end_layout

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
bottomrule
\end_layout

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
<cell alignment="none" valignment="top" usebox="none">
\begin_inset Text

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "tblresults1"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

The baseline `small-area' scenario consists of three iterations of IPF, in which all three constraints were used. The results for all 9 constraint-iteration permutations of this baseline scenario are illustrated in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

fipfinac
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 and 
\begin_inset ERT
status collapsed

\begin_layout Standard

%??? ref
\end_layout

\begin_layout Standard


\end_layout

\end_inset

in the online `measures' table. These results show that IPF successfully brings the simulated cell counts in-line with the census after each constraint is applied and that the fit improves with each iteration (only two iterations are shown here, as the fit improves very little beyond two, and to avoid clutter).
\end_layout

\begin_layout Standard


\begin_inset Float figure
wide false
sideways false
status open


\begin_layout Standard
\align center


\begin_inset Graphics 
	filename ipfinac
	width 12cm

\end_inset

 
\end_layout

\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

IPF in action: simulated vs census zone counts for the small-area baseline scenario after each constraint (columns) and iteration (rows).
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "fipfinac"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

The baseline `Sheffield' scenario consists of the same basic set-up, but with 4 constraints. As before, the results show convergence towards better model fit, although the fit does not always improve from one constraint to the next (see the online `measures' table). 
\begin_inset ERT
status collapsed

\begin_layout Standard

% online???
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

Constraints and iterations
\end_layout

\begin_layout Standard

These were the simplest model experiments, requiring only the reporting of iterations that had already taken place, and re-arrangement of the IPF code such that constraints were applied in a different order than before. The re-ordered code for the `small-area' scenario, for example can be seen in the script `etsim-reordered' online.
\end_layout

\begin_layout Subsection

Initial weights
\end_layout

\begin_layout Standard

The impact of initial weights was tested in two ways: first, the impact of changing a sample of one or more initial weight values by a set amount was explored. Second, the impact of of the size of the initial weights was tested, by running the same model experiment several times, but with incrementally larger initial weights applied to a pre-determined set of individuals.
\end_layout

\begin_layout Subsection

Empty cells
\end_layout

\begin_layout Standard

Empty cells refer to cross-tabulations of individual-level attributes that are not represented by any single individual in the survey input data. An example of this would be if no female in the 16 to 49 year age bracket were present in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

t:w
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

. The method used to find-out if empty cells exist is to first select only individuals with unique characteristics (in the narrow terms of the constraint variables --- of course every survey individual is unique). The column totals of the categorical (binary, 0 or 1) form of this dataset are compared: any categories with fewer than expected totals have missing cells.
\end_layout

\begin_layout Standard

Once the presence of empty cells is determined in the baseline scenarios, the next stage is to add or subtract empty cells by adding or subtracting individuals to the input data. After these changes were made, the baseline scenarios were run as before.
\end_layout

\begin_layout Standard

In the ‘simple’ scenario, this simply involves removing a single individual from the input data, which equates to deleting a single line of code (see `etsim-empty'). 
\begin_inset ERT
status collapsed

\begin_layout Standard

%??? online 
\end_layout

\begin_layout Standard


\end_layout

\end_inset

The question of which unique individual to remove is solved by random sampling.
\end_layout

\begin_layout Subsection

Integerisation
\end_layout

\begin_layout Standard

This was the next variable that was altered, following 
\begin_inset CommandInset citation
LatexCommand citep
after ""
before ""
key "Lovelace2013-trs"

\end_inset

. In the simplest scenario, the initial weight of a single individual was altered repeatedly, in a controlled manner. The code enabling this model experiment is contained in the folder `small-area-weights' (see `etsim.R'). The number of different initial weights can be controlled by the parameter `num.ws' which is set to 5 as an arbitrary default. Initial weights are set to k, a vector of length `num.ws' which are by default set as a function of `u' which is in term defined as the sequence 1:num.ws:
\end_layout

\begin_layout Standard


\begin_inset listings
inline false
status collapsed

\begin_layout Plain Layout

k <- u/5 + 0.5 # initial weight of sample individuals for testing 
\end_layout

\end_inset


\end_layout

\begin_layout Standard

In this case the resultant weights are set to 0.7, 0.9, 1.1, 1.3 and 1.5 for each model experiment. For factors of one million, for example, the above would be replaced by 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
lstinline
\end_layout

\end_inset

 !k <- u * 106 yrm!. To observe the impacts of altering the weights in this way the usual tests of model fit were conducted. In addition, the capacity of initial weights to influence an individual's final weight/probability of selection was tested by tracing its weight into the future after each successive constraint and iteration. This enabled plotting original vs simulated weights under a range of conditions (
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

cresults
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

).
\end_layout

\begin_layout Section

Results
\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "cresults"

\end_inset


\end_layout

\begin_layout Subsection

Baseline scenarios
\end_layout

\begin_layout Standard

As expected from 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

fipfinac
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 above, the correlation of the baseline scenario improves over time, with each constraint and from one iteration to the next. Through the course of the first iteration, the correlation improves from 0.67 (the correlation between the frequencies of variables in the survey dataset and their frequencies in the census dataset, for each zone) to 0.9981. As illustrated in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

fnconscor
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

, the marginal improvement reduces from one iteration to the next: at the end of iteration 2, the correlation has improved to 0.999978.
\end_layout

\begin_layout Standard


\begin_inset Float figure
wide false
sideways false
status open


\begin_layout Standard
\align center


\begin_inset Graphics 
	filename corr-baseline
	width 6cm

\end_inset

 
\end_layout

\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Improvement in goodness of fit with additional constraints and iterations, as illustrated by 
\begin_inset Formula $r$
\end_inset

 values.
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "fnconscor"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Subsection

Constraints and iterations
\end_layout

\begin_layout Standard

As illustrated above, the number of iterations required to reach a very close fit between the census and simulated data is very low, with rapid reductions in the marginal accuracy return on additional computing power. After four iterations, the result in R is indistinguishable from 1, with its default accuracy of 7 decimal places. The decay in the rate of improvement with additional iterations and constraints was found to super-exponential.
\end_layout

\begin_layout Subsection

Initial weights
\end_layout

\begin_layout Standard

It was found that initial weights had little impact on the overall simulation. Taking the simplest case, a random individual (id = 228) was selected from the `small area' data and his/her initial weight was set to 2 (instead of the default of 1). The impact of this change on the individual's simulated weight decayed rapidly, tending to zero after only 5 iterations in the small-area scenario. It was found that altered initial weights affect the simulated weights of all other individuals; this is illustrated in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

ficweight
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

, which shows the impact on individual 228 and a randomly selected individual whose initial weight was not altered, for all areas.
\end_layout

\begin_layout Standard


\begin_inset Float figure
wide false
sideways false
status open


\begin_layout Standard
\align center


\begin_inset Graphics 
	filename weight-1-5-its
	width 12cm

\end_inset

 
\end_layout

\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

The impact of changing the initial weight of individual 228 on the simulated weights of two individuals after 5 iterations. Each of the 24 coloured lines represents a single zone.
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "ficweight"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

ficweight
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 shows that changing initial weights for individuals has a limited impact on the results that tends to zero from one iteration to the next. After iteration one the impact of a 100% increase in the initial weight of individual 228 had reduced to 0.3%; after 3 iterations the impact was negligible. The same pattern can be observed in the control individual 570, although the impact is smaller and in the reverse direction. The same pattern can be observed for other individuals, by altering the `analysis.min'.
\end_layout

\begin_layout Standard

To analyse the impacts of changing the initial weights of multiple individuals, the same experiment was conducted, but this time the initial weights were applied to the first five individuals. The results are illustrated in 
\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

finweight
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

, which shows the relationship between initial and final weights for the first two individuals and another two individuals (randomly selected to show the impact of altering weights on other individual weights).
\end_layout

\begin_layout Standard


\begin_inset Float figure
wide false
sideways false
status open


\begin_layout Standard
\align center


\begin_inset Graphics 
	filename weights-exp-54nice2
	width 12cm

\end_inset

 
\end_layout

\begin_layout Standard


\begin_inset Caption

\begin_layout Standard

Initial vs simulated weight of four individuals for a single area (zone 1).
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset CommandInset label
LatexCommand label
name "finweight"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard


\begin_inset ERT
status collapsed

\begin_layout Standard


\backslash
cref
\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

finweight
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

 shows that the vast majority of the impact of altered starting weights occurs in iteration-constraint combinations 1.1 and 1.2, before a complete iteration has even occurred. After that, the initial weights continue to have an influence, of a magnitude that cannot be seen. For individual 1, the impact of a 53% difference in initial weights (from 0.7 to 1.5) shrinks to 2.0% by iteration 1.3 and to 1.1% by iteration 2.3.
\end_layout

\begin_layout Standard

These results suggest that initial weights have a limited impact on the results of IPF, that declines rapidly with each iteration.
\end_layout

\begin_layout Subsection

Empty cells
\end_layout

\begin_layout Subsection

Integerisation
\end_layout

\begin_layout Section

Conclusions
\end_layout

\begin_layout Standard

 
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "/home/robin/Documents/Microsimulation.bib"
options "model2-names.bst"

\end_inset

 
\begin_inset ERT
status collapsed

\begin_layout Standard

%/nfs/foe-fs-01_users/georl/repos/IPF-performance-testing/paper/ipflib.bib  desktop.bib,
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% /home/robin/Documents/powerstarrefs/Microsimulation.bib
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Standard

% /nfs/foe-fs-01_users/georl/Documents/Microsimulation.bib,
\end_layout

\begin_layout Standard


\end_layout

\end_inset


\end_layout

\end_body
\end_document
